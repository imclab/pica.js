<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Pica.js Demo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="author" content="">

  <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
  <!--[if lt IE 9]>
    <script src="//html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->

  <link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/css/bootstrap-combined.min.css" rel="stylesheet">
  <link rel="stylesheet" href="//cdn.leafletjs.com/leaflet-0.4.5/leaflet.css" />
  <link rel="stylesheet" href="css/leaflet.draw.css" />
  <!--[if lte IE 8]>
    <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.4.5/leaflet.ie.css" />
  <![endif]-->
  <link rel="stylesheet" href="css/app.css" />

  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
  <script src="//cdn.leafletjs.com/leaflet-0.4.5/leaflet.js"></script>
  <script src="js/leaflet.draw.js"></script>

  <script src="https://raw.github.com/unepwcmc/pica.js/master/dist/pica.js.js"></script>

  <script>
    $(document).ready(function() {
      var AreaView, map, pica, tileLayer, tileLayerUrl;
      map = L.map('map').setView([0, 0], 2);
      tileLayerUrl = 'http://carbon-tool.cartodb.com/tiles/ne_countries/{z}/{x}/{y}.png';
      tileLayer = new L.TileLayer(tileLayerUrl, {
        maxZoom: 18
      }).addTo(map);
      pica = new Pica.Application({
        magpieUrl: "http://magpie.unepwcmc-005.vm.brightbox.net",
        appId: 3,
        map: map
      });
      pica.newWorkspace();
      pica.currentWorkspace.currentArea.drawNewPolygonView(function(polygon) {
        AreaView("#side-panel");
        return pica.currentWorkspace.currentArea.stats();
      });
      return AreaView = (function(targetElement) {
        var render;
        render = function(stats) {
          var stat, _i, _len, _results;
          stat = void 0;
          _i = 0;
          _len = stats.length;
          $(targetElement).empty();
          _results = [];
          while (_i < _len) {
            stat = stats[_i];
            $(targetElement).append(stat.name + ": " + stat.value + stat.unit + "<br/>");
            _results.push(_i++);
          }
          return _results;
        };
        return function() {
          pica.currentWorkspace.currentArea.on("area:statsCalculated", render);
          return console.log('user AreaView, waiting for area:statsCalculated');
        };
      })();
    });
  </script>

</head>
<body>
  <div class="container-fluid">
    <div id="header">
      <h1>Pica.js demo</h1>
    </div>
    <div class="row-fluid">
      <div class="span9">
        <!--Body content-->
        <div id="map"></div>
      </div>
      <div class="span3 well">
        <!--Sidebar content-->
        <div id="side-panel"></div>
      </div>
    </div>
  </div>

  <script type="text/javascript">
  </script>
</body>
</html>
